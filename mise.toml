[settings]
experimental = true

[tools]
gitleaks = "latest"
hk = "latest"
pkl = "latest"

[tasks.test-bootstrap]
description = "Test bootstrap in a fresh Docker container using local dotfiles"
run = """
docker run --rm \
  -v "$PWD:/dotfiles:ro" \
  -e DEBIAN_FRONTEND=noninteractive \
  ubuntu:latest \
  bash -c "
    set -e
    echo 'ðŸ§ª Setting up test environment...'
    apt-get update -qq 2>&1 > /dev/null
    apt-get install -y -qq apt-utils 2>&1 > /dev/null
    apt-get install -y -qq curl git sudo 2>&1 > /dev/null
    useradd -m -s /bin/bash testuser
    echo 'testuser ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers
    echo
    su - testuser -c 'bash /dotfiles/test-bootstrap.sh'
  "
"""

[hooks]
postinstall = "hk install --mise"
