# ~/.aerospace.toml

# Aerospace startup behavior
start-at-login = true
after-login-command = []

# Sticky keymapp + self-healing WezTerm instances
exec-on-workspace-change = ['/Users/jkp/.config/aerospace/on-workspace-change.sh']

after-startup-command = [
    'exec-and-forget /opt/homebrew/bin/borders active_color=0xff27AABB width=7 hidpi=on',
    'exec-and-forget ~/.config/aerospace/ensure-wezterm.sh personal 1-personal',
    'exec-and-forget sleep 3 && ~/.config/aerospace/ensure-wezterm.sh work 2-work',
]

# Mouse focus behavior
on-focused-monitor-changed = ['move-mouse monitor-lazy-center']

# Misc UI tweaks
automatically-unhide-macos-hidden-apps = false

[key-mapping]
preset = 'qwerty'

[gaps]
inner.horizontal = 10
inner.vertical = 10
outer.left = 5
outer.bottom = 5
outer.top = 5
outer.right = 5

# =============================================================================
# BASE LAYER (Meh = alt-ctrl-shift)
# =============================================================================
[mode.main.binding]
   # --- Focus (right hand home row) ---
   alt-ctrl-shift-m = "focus --ignore-floating left"
   alt-ctrl-shift-n = "focus --ignore-floating down"
   alt-ctrl-shift-e = "focus --ignore-floating up"
   alt-ctrl-shift-i = "focus --ignore-floating right"

   # --- Workspaces (right hand) ---
   alt-ctrl-shift-l = "workspace 1-personal"
   alt-ctrl-shift-u = "workspace 2-work"
   alt-ctrl-shift-y = "workspace 3-music"
   alt-ctrl-shift-semicolon = "workspace 4-notes"
   alt-ctrl-shift-o = "workspace 5-scratch"

   # --- Focus by role (bottom row right hand) ---
   alt-ctrl-shift-h = 'exec-and-forget ~/.config/aerospace/focus-role.sh Safari Chrome Helium'
   alt-ctrl-shift-comma = 'exec-and-forget ~/.config/aerospace/focus-role.sh WezTerm'
   alt-ctrl-shift-period = 'exec-and-forget ~/.config/aerospace/focus-role.sh Claude ChatGPT'
   alt-ctrl-shift-slash = 'exec-and-forget ~/.config/aerospace/focus-role.sh WhatsApp Messages'

   # --- Workspace navigation ---
   alt-ctrl-shift-backspace = 'exec-and-forget ~/.config/aerospace/toggle-context.sh'

   # --- Mode entry (left hand home row) ---
   alt-ctrl-shift-a = "mode floating-nav"
   alt-ctrl-shift-r = "mode resize"
   alt-ctrl-shift-s = "mode swap"
   alt-ctrl-shift-t = "mode tidy"

   # --- Move window direction (Meh+Cmd) ---
   alt-ctrl-shift-cmd-m = "move left"
   alt-ctrl-shift-cmd-n = "move down"
   alt-ctrl-shift-cmd-e = "move up"
   alt-ctrl-shift-cmd-i = "move right"

   # --- Move window to workspace (Meh+Cmd) ---
   alt-ctrl-shift-cmd-l = ["move-node-to-workspace 1-personal", "workspace 1-personal"]
   alt-ctrl-shift-cmd-u = ["move-node-to-workspace 2-work", "workspace 2-work"]
   alt-ctrl-shift-cmd-y = ["move-node-to-workspace 3-music", "workspace 3-music"]
   alt-ctrl-shift-cmd-semicolon = ["move-node-to-workspace 4-notes", "workspace 4-notes"]
   alt-ctrl-shift-cmd-o = ["layout floating", "move-node-to-workspace 5-scratch", "workspace 5-scratch"]

   # --- Utilities (Meh+Cmd) ---
   alt-ctrl-shift-cmd-v = 'exec-and-forget ~/.config/aerospace/toggle-keymapp.sh'

# =============================================================================
# FLOATING-NAV MODE (Meh+A) - Sticky
# Escape floating windows by focusing any direction
# =============================================================================
[mode.floating-nav.binding]
   # Actions (bare or with meh held)
   m = "focus left"
   n = "focus down"
   e = "focus up"
   i = "focus right"
   alt-ctrl-shift-m = "focus left"
   alt-ctrl-shift-n = "focus down"
   alt-ctrl-shift-e = "focus up"
   alt-ctrl-shift-i = "focus right"
   # Mode switching
   r = "mode resize"
   s = "mode swap"
   t = "mode tidy"
   alt-ctrl-shift-r = "mode resize"
   alt-ctrl-shift-s = "mode swap"
   alt-ctrl-shift-t = "mode tidy"
   # Exit
   a = "mode main"
   alt-ctrl-shift-a = "mode main"
   esc = "mode main"
   # Block unused keys
   b = []
   c = []
   d = []
   f = []
   g = []
   h = []
   j = []
   k = []
   l = []
   o = []
   p = []
   q = []
   u = []
   v = []
   w = []
   x = []
   y = []
   z = []
   period = []
   comma = []
   semicolon = []
   slash = []

# =============================================================================
# RESIZE MODE (Meh+R) - Sticky
# Resize windows directionally
# =============================================================================
[mode.resize.binding]
   # Actions (bare or with meh held)
   m = "resize smart -50"
   n = "resize smart -50"
   e = "resize smart +50"
   i = "resize smart +50"
   alt-ctrl-shift-m = "resize smart -50"
   alt-ctrl-shift-n = "resize smart -50"
   alt-ctrl-shift-e = "resize smart +50"
   alt-ctrl-shift-i = "resize smart +50"
   # Mode switching
   s = "mode swap"
   t = "mode tidy"
   alt-ctrl-shift-s = "mode swap"
   alt-ctrl-shift-t = "mode tidy"
   # Exit
   a = "mode main"
   alt-ctrl-shift-a = "mode main"
   esc = "mode main"
   # Block unused keys
   b = []
   c = []
   d = []
   f = []
   g = []
   h = []
   j = []
   k = []
   l = []
   o = []
   p = []
   q = []
   r = []
   u = []
   v = []
   w = []
   x = []
   y = []
   z = []
   period = []
   comma = []
   semicolon = []
   slash = []

# =============================================================================
# SWAP MODE (Meh+S) - Sticky
# Move windows in direction
# =============================================================================
[mode.swap.binding]
   # Actions (bare or with meh held)
   m = "move left"
   n = "move down"
   e = "move up"
   i = "move right"
   alt-ctrl-shift-m = "move left"
   alt-ctrl-shift-n = "move down"
   alt-ctrl-shift-e = "move up"
   alt-ctrl-shift-i = "move right"
   # Mode switching
   r = "mode resize"
   t = "mode tidy"
   alt-ctrl-shift-r = "mode resize"
   alt-ctrl-shift-t = "mode tidy"
   # Exit
   a = "mode main"
   alt-ctrl-shift-a = "mode main"
   esc = "mode main"
   # Block unused keys
   b = []
   c = []
   d = []
   f = []
   g = []
   h = []
   j = []
   k = []
   l = []
   o = []
   p = []
   q = []
   s = []
   u = []
   v = []
   w = []
   x = []
   y = []
   z = []
   period = []
   comma = []
   semicolon = []
   slash = []

# =============================================================================
# TIDY MODE (Meh+T) - Sticky
# Layout and housekeeping operations
# =============================================================================
[mode.tidy.binding]
   # Actions (bare or with meh held)
   n = "layout horizontal vertical"
   e = "layout accordion tiles"
   i = "balance-sizes"
   o = "flatten-workspace-tree"
   m = "macos-native-fullscreen"
   l = 'exec-and-forget ~/.config/aerospace/cleanup-phantom-windows.sh'
   alt-ctrl-shift-n = "layout horizontal vertical"
   alt-ctrl-shift-e = "layout accordion tiles"
   alt-ctrl-shift-i = "balance-sizes"
   alt-ctrl-shift-o = "flatten-workspace-tree"
   alt-ctrl-shift-m = "macos-native-fullscreen"
   alt-ctrl-shift-l = 'exec-and-forget ~/.config/aerospace/cleanup-phantom-windows.sh'
   # Mode switching
   r = "mode resize"
   s = "mode swap"
   alt-ctrl-shift-r = "mode resize"
   alt-ctrl-shift-s = "mode swap"
   # Exit
   a = "mode main"
   alt-ctrl-shift-a = "mode main"
   esc = "mode main"
   # Block unused keys
   b = []
   c = []
   d = []
   f = []
   g = []
   j = []
   k = []
   # l = []
   p = []
   q = []
   t = []
   u = []
   v = []
   w = []
   x = []
   y = []
   z = []
   period = []
   comma = []
   semicolon = []
   slash = []

# =============================================================================
# AUTO-ASSIGNMENT RULES
# =============================================================================
[[on-window-detected]]
   if.app-name-regex-substring = 'Keymapp'
   run = ['layout floating']

[[on-window-detected]]
   if.app-name-regex-substring = 'Finder'
   run = ['layout floating']

[[on-window-detected]]
   if.app-name-regex-substring = '1Password'
   run = ['layout floating']

[[on-window-detected]]
   if.app-name-regex-substring = 'Spotify'
   run = ['move-node-to-workspace 3-music']

[[on-window-detected]]
   if.app-name-regex-substring = 'JPLAY'
   run = ['move-node-to-workspace 3-music']

[[on-window-detected]]
   if.app-name-regex-substring = 'Claude'
   run = ['move-node-to-workspace 1-personal']

[[on-window-detected]]
   if.app-name-regex-substring = 'ChatGPT'
   run = ['move-node-to-workspace 2-work']

[[on-window-detected]]
   if.app-name-regex-substring = 'WhatsApp'
   run = ['move-node-to-workspace 2-work']

[[on-window-detected]]
   if.app-name-regex-substring = 'Messages'
   run = ['move-node-to-workspace 1-personal']

[[on-window-detected]]
   if.app-name-regex-substring = 'Google Chrome'
   run = ['move-node-to-workspace 2-work']

[[on-window-detected]]
   if.app-name-regex-substring = 'Helium'
   run = ['move-node-to-workspace 2-work']

[[on-window-detected]]
   if.app-name-regex-substring = 'Safari'
   run = ['move-node-to-workspace 1-personal']

[[on-window-detected]]
   if.app-name-regex-substring = 'Obsidian'
   run = ['move-node-to-workspace 4-notes']

# Auto-float windows opening on scratch
[[on-window-detected]]
   if.workspace = '5-scratch'
   run = ['layout floating']
